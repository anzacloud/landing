"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createUrlSet = void 0;
const util_1 = require("../util");
const array_1 = require("../../array");
/**
 * Create a unique url set
 * @param config
 * @param manifest
 */
exports.createUrlSet = (config, manifest) => {
    let allKeys = [
        ...Object.keys(manifest.build.pages),
        ...(manifest.preRender ? Object.keys(manifest.preRender.routes) : []),
    ];
    // Remove the urls based on config.exclude array
    if (config.exclude) {
        allKeys = array_1.removeFromArray(allKeys, config.exclude);
    }
    // Filter out next.js internal urls and generate urls based on sitemap
    let urlSet = allKeys.filter((x) => !util_1.isNextInternalUrl(x));
    urlSet = [...new Set(urlSet)];
    // Create sitemap fields based on transformation
    const sitemapFields = urlSet
        .map((url) => config.transform(config, url)) // transform using relative urls
        .filter((x) => Boolean(x) && Boolean(x.loc)) // remove null values
        .map((x) => ({
        ...x,
        loc: util_1.generateUrl(config.siteUrl, config.trailingSlash ? `${x.loc}/` : x.loc),
    }));
    return sitemapFields;
};
